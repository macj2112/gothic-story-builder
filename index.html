<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gothic Short Story Builder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #1c1c1c;
      color: #f0f0f0;
      padding: 20px;
    }

    h1 {
      color: #e74c3c;
    }

    .wheels {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    canvas {
      border: 2px solid #555;
      border-radius: 10px;
      background-color: #2c2c2c;
    }

    #spinButton {
      padding: 15px 30px;
      font-size: 1.2em;
      background-color: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #spinButton:hover {
      background-color: #c0392b;
    }

    #storyContainer {
      background-color: #333;
      padding: 20px;
      border-radius: 10px;
      min-height: 150px;
      max-width: 800px;
      margin: 0 auto;
      text-align: left;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Gothic Short Story Builder</h1>

  <div class="wheels">
    <canvas id="wheelSetting" width="200" height="200"></canvas>
    <canvas id="wheelSupernatural" width="200" height="200"></canvas>
    <canvas id="wheelForeshadowing" width="200" height="200"></canvas>
    <canvas id="wheelSensory" width="200" height="200"></canvas>
    <canvas id="wheelNarrator" width="200" height="200"></canvas>
  </div>

  <button id="spinButton">Spin All Wheels</button>

  <div id="storyContainer"></div>

  <!-- Include Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Winwheel.js/2.7.0/Winwheel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/gsap.min.js"></script>

  <!-- Application Script -->
  <script>
    // Define the elements for each category
    const elements = {
      setting: [
        'Crumbling Castle',
        'Dark Forest',
        'Isolated Manor House',
        'Abandoned Asylum',
        'Foggy Moorlands',
        'Victorian Estate',
        'Desolate Lighthouse',
        'Ancient Crypt'
      ],
      supernatural: [
        'Ghosts',
        'Vampires',
        'Werewolves',
        'Witches',
        'Undead Spirits',
        'Cursed Objects',
        'Shape-shifters',
        'Haunted Mirrors'
      ],
      foreshadowing: [
        'Ominous Weather Changes',
        'Recurring Nightmares',
        'Mysterious Symbols',
        'Unexplained Sounds',
        'Prophetic Dreams',
        'Strange Shadows',
        'Foreboding Warnings',
        'Hidden Letters'
      ],
      sensory: [
        'Whispering Winds',
        'Faint Echoes',
        'Musty Smells',
        'Cold Touches',
        'Dim Lighting',
        'Creaking Floors',
        'Rustling Leaves',
        'Foggy Visibility'
      ],
      narrator: [
        'Mentally Unstable',
        'Possessed',
        'Secretive Past',
        'Paranoid',
        'Hallucinating',
        'Deceptive',
        'Amnesiac',
        'Obsessive'
      ]
    };

    // Function to generate segments for Winwheel
    function generateSegments(category, colors) {
      return category.map((text, index) => ({
        fillStyle: colors[index % colors.length],
        text: text
      }));
    }

    // Define colors for segments
    const colors = ['#e74c3c', '#8e44ad', '#3498db', '#f1c40f', '#2ecc71', '#e67e22', '#1abc9c', '#9b59b6'];

    // Initialize wheels
    const wheels = {};

    wheels.setting = new Winwheel({
      'canvasId': 'wheelSetting',
      'numSegments': elements.setting.length,
      'segments': generateSegments(elements.setting, colors),
      'animation': {
        'type': 'spinToStop',
        'duration': 5,
        'spins': 8,
        'callbackFinished': 'spinComplete("setting")'
      }
    });

    wheels.supernatural = new Winwheel({
      'canvasId': 'wheelSupernatural',
      'numSegments': elements.supernatural.length,
      'segments': generateSegments(elements.supernatural, colors),
      'animation': {
        'type': 'spinToStop',
        'duration': 5,
        'spins': 8,
        'callbackFinished': 'spinComplete("supernatural")'
      }
    });

    wheels.foreshadowing = new Winwheel({
      'canvasId': 'wheelForeshadowing',
      'numSegments': elements.foreshadowing.length,
      'segments': generateSegments(elements.foreshadowing, colors),
      'animation': {
        'type': 'spinToStop',
        'duration': 5,
        'spins': 8,
        'callbackFinished': 'spinComplete("foreshadowing")'
      }
    });

    wheels.sensory = new Winwheel({
      'canvasId': 'wheelSensory',
      'numSegments': elements.sensory.length,
      'segments': generateSegments(elements.sensory, colors),
      'animation': {
        'type': 'spinToStop',
        'duration': 5,
        'spins': 8,
        'callbackFinished': 'spinComplete("sensory")'
      }
    });

    wheels.narrator = new Winwheel({
      'canvasId': 'wheelNarrator',
      'numSegments': elements.narrator.length,
      'segments': generateSegments(elements.narrator, colors),
      'animation': {
        'type': 'spinToStop',
        'duration': 5,
        'spins': 8,
        'callbackFinished': 'spinComplete("narrator")'
      }
    });

    // Spin All Wheels on Button Click
    document.getElementById('spinButton').addEventListener('click', () => {
      // Disable the button to prevent multiple spins
      document.getElementById('spinButton').disabled = true;

      // Reset selected elements
      selectedElements = {
        setting: null,
        supernatural: null,
        foreshadowing: null,
        sensory: null,
        narrator: null
      };
      completedSpins = 0;
      document.getElementById('storyContainer').innerText = 'Spinning wheels...';

      // Start spinning all wheels
      for (let key in wheels) {
        wheels[key].startAnimation();
      }
    });

    // Variables to track selected elements and completed spins
    let selectedElements = {
      setting: null,
      supernatural: null,
      foreshadowing: null,
      sensory: null,
      narrator: null
    };
    let completedSpins = 0;

    // Callback function when a wheel finishes spinning
    function spinComplete(category) {
      selectedElements[category] = wheels[category].getIndicatedSegment().text;
      completedSpins += 1;

      // Check if all wheels have finished spinning
      if (completedSpins === Object.keys(wheels).length) {
        generateStory(selectedElements);
        document.getElementById('spinButton').disabled = false;
      }
    }

    // Generate the short story based on selected elements
    function generateStory(elements) {
      const story = `
        In the heart of the ${elements.setting}, a ${elements.supernatural} lurked in the shadows.
        The story unfolds with ${elements.foreshadowing}, hinting at the dark events to come.
        The atmosphere is thick with ${elements.sensory}, making every step feel ominous.
        The tale is narrated by a ${elements.narrator}, whose perspective adds layers of mystery and doubt.
        Together, these elements weave a chilling gothic narrative that captivates and terrifies.
      `;

      displayStory(story);
    }

    // Display the generated story in the container
    function displayStory(story) {
      const storyContainer = document.getElementById('storyContainer');
      storyContainer.innerText = story;
    }
  </script>
</body>
</html>
